{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/kartikarora/alt/src/app/add-venue/step-8-summary/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRouter, useSearchParams } from \"next/navigation\";\nimport { useState, useMemo } from \"react\";\nimport { supabaseBrowser } from \"@/lib/supabase/client\";\n\nexport default function SummaryPage() {\n  const router = useRouter();\n  const params = useSearchParams();\n  const listingId = params.get(\"id\") ?? params.get(\"listingId\");\n  const startDate = params.get(\"startDate\")!;\n  const endDate = params.get(\"endDate\")!;\n  const excluded = (params.get(\"excludedDates\") || \"\").split(\",\").filter(Boolean);\n  const unit = params.get(\"unit\") || \"night\";\n  const pricePerUnit = Number(params.get(\"pricePerUnit\") || 0);\n  const discounts = (() => {\n    try { return JSON.parse(params.get(\"discounts\") || \"[]\"); } catch { return []; }\n  })();\n\n  const unitsCount = (() => {\n    const s = new Date(startDate); const e = new Date(endDate);\n    const diff = Math.round((e.getTime()-s.getTime())/(24*3600*1000)) + 1;\n    return Math.max(0, diff - excluded.length);\n  })();\n\n  const subtotal = unitsCount * pricePerUnit;\n  const applicable = discounts.filter((d:any)=> unitsCount >= d.min_units);\n  const topPercent = applicable.length ? Math.max(...applicable.map((d:any)=>d.percent)) : 0;\n  const discountAmount = +(subtotal * (topPercent/100));\n  const afterDiscount = subtotal - discountAmount;\n  const commission = +(afterDiscount * 0.05).toFixed(2);\n  const serviceFee = +((afterDiscount + commission) * 0.01).toFixed(2);\n  const total = +(afterDiscount + commission + serviceFee).toFixed(2);\n\n  const [creating, setCreating] = useState(false);\n\n  async function handleConfirm() {\n    setCreating(true);\n\n    // 1) create booking row in DB (status pending)\n    const { error: insertErr } = await supabaseBrowser.from(\"bookings\").insert([{\n      listing_id: listingId,\n      user_id: (await supabaseBrowser.auth.getUser()).data?.user?.id ?? null,\n      start_date: startDate,\n      end_date: endDate,\n      excluded_dates: excluded.length ? excluded : null,\n      unit,\n      price_per_unit: pricePerUnit,\n      total_units: unitsCount,\n      subtotal,\n      discount_amount: discountAmount,\n      commission_amount: commission,\n      service_fee: serviceFee,\n      total_amount: total,\n      status: \"pending\"\n    }]);\n\n    if (insertErr) {\n      alert(insertErr.message);\n      setCreating(false);\n      return;\n    }\n\n    // 2) call server to create razorpay order (placeholder)\n    const res = await fetch(\"/api/razorpay/create-order\", {\n      method: \"POST\",\n      headers: { \"content-type\":\"application/json\" },\n      body: JSON.stringify({ amount: Math.round(total*100), currency: \"INR\", bookingId: \"TODO\" })\n    });\n\n    const json = await res.json();\n    if (!res.ok) {\n      alert(json?.message ?? \"Failed to create order\");\n      setCreating(false);\n      return;\n    }\n\n    // 3) redirect to Razorpay Checkout (client-side)\n    // expected json: { orderId, razorpayKey }\n    const { orderId, razorpayKey } = json;\n    // open checkout (simple redirect approach)\n    // you should integrate Razorpay Checkout script on client and call Razerpay checkout with orderId\n    alert(\"Order created. Now integrate Razorpay Checkout; server returned: \" + JSON.stringify(json));\n    setCreating(false);\n  }\n\n  return (\n    <div className=\"min-h-screen p-6 bg-[radial-gradient(circle_at_top_left,#07102a_0%,#03031a_60%)] text-white\">\n      <div className=\"max-w-3xl mx-auto bg-[#07102a]/80 p-6 rounded-xl border border-zinc-800\">\n        <h2 className=\"text-2xl font-semibold mb-4\">Booking Summary</h2>\n\n        <table className=\"w-full mb-4\">\n          <tbody>\n            <tr><td>Dates</td><td>{startDate} → {endDate} (excluded: {excluded.join(\", \") || \"none\"})</td></tr>\n            <tr><td>Units</td><td>{unitsCount} {unit}(s)</td></tr>\n            <tr><td>Price / {unit}</td><td>₹{pricePerUnit.toFixed(2)}</td></tr>\n            <tr><td>Subtotal</td><td>₹{subtotal.toFixed(2)}</td></tr>\n            <tr><td>Discount</td><td>- ₹{discountAmount.toFixed(2)} ({topPercent}%)</td></tr>\n            <tr><td>Commission (5%)</td><td>₹{commission.toFixed(2)}</td></tr>\n            <tr><td>Service fee (1%)</td><td>₹{serviceFee.toFixed(2)}</td></tr>\n            <tr className=\"font-bold text-lg\"><td>Total</td><td>₹{total.toFixed(2)}</td></tr>\n          </tbody>\n        </table>\n\n        <div className=\"flex gap-2\">\n          <button onClick={handleConfirm} disabled={creating} className=\"px-4 py-2 bg-blue-600 rounded\">\n            {creating ? \"Processing…\" : \"Confirm & Pay\"}\n          </button>\n          <button onClick={()=>router.back()} className=\"px-4 py-2 bg-zinc-700 rounded\">Back</button>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 385, "column": 0}, "map": {"version":3,"sources":["file:///Users/kartikarora/alt/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxDevRuntime\n"],"names":["module","exports","require","vendored","ReactJsxDevRuntime"],"mappings":"AAAAA,OAAOC,OAAO,GACZC,QAAQ,gIACRC,QAAQ,CAAC,YAAY,CAAEC,kBAAkB","ignoreList":[0]}}]
}