{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/kartikarora/alt/src/components/ProfileImageUploader.tsx"],"sourcesContent":["// src/components/ProfileImageUploader.tsx\n\"use client\";\n\nimport { useRef, useState } from \"react\";\nimport { supabaseBrowser } from \"@/lib/supabase/client\";\n\ntype Props = {\n  userId: string;\n  onUpload: (url: string) => void;\n};\n\nexport default function ProfileImageUploader({ userId, onUpload }: Props) {\n  const fileRef = useRef<HTMLInputElement | null>(null);\n  const [uploading, setUploading] = useState(false);\n\n  async function handleUpload(e: React.ChangeEvent<HTMLInputElement>) {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    setUploading(true);\n    const ext = file.name.split(\".\").pop();\n    const filePath = `avatars/${userId}-${Date.now()}.${ext}`;\n\n    const { error } = await supabaseBrowser.storage.from(\"profiles\").upload(filePath, file, {\n      cacheControl: \"3600\",\n      upsert: true,\n    });\n\n    if (error) {\n      alert(error.message);\n      setUploading(false);\n      return;\n    }\n\n    const { data } = supabaseBrowser.storage.from(\"profiles\").getPublicUrl(filePath);\n    onUpload(data.publicUrl);\n    setUploading(false);\n  }\n\n  return (\n    <div>\n      <input ref={fileRef} type=\"file\" className=\"hidden\" accept=\"image/*\" onChange={handleUpload} />\n      <button type=\"button\" onClick={() => fileRef.current?.click()} className=\"px-4 py-2 bg-purple-600 rounded-md\">\n        {uploading ? \"Uploading‚Ä¶\" : \"Upload Profile Picture\"}\n      </button>\n    </div>\n  );\n}\n"],"names":[],"mappings":"AAAA,0CAA0C;;;;;;AAG1C;AACA;AAHA;;;;AAUe,SAAS,qBAAqB,EAAE,MAAM,EAAE,QAAQ,EAAS;IACtE,MAAM,UAAU,IAAA,sNAAM,EAA0B;IAChD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,wNAAQ,EAAC;IAE3C,eAAe,aAAa,CAAsC;QAChE,MAAM,OAAO,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE;QAChC,IAAI,CAAC,MAAM;QACX,aAAa;QACb,MAAM,MAAM,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG;QACpC,MAAM,WAAW,CAAC,QAAQ,EAAE,OAAO,CAAC,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK;QAEzD,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,0JAAe,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,MAAM,CAAC,UAAU,MAAM;YACtF,cAAc;YACd,QAAQ;QACV;QAEA,IAAI,OAAO;YACT,MAAM,MAAM,OAAO;YACnB,aAAa;YACb;QACF;QAEA,MAAM,EAAE,IAAI,EAAE,GAAG,0JAAe,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,YAAY,CAAC;QACvE,SAAS,KAAK,SAAS;QACvB,aAAa;IACf;IAEA,qBACE,qPAAC;;0BACC,qPAAC;gBAAM,KAAK;gBAAS,MAAK;gBAAO,WAAU;gBAAS,QAAO;gBAAU,UAAU;;;;;;0BAC/E,qPAAC;gBAAO,MAAK;gBAAS,SAAS,IAAM,QAAQ,OAAO,EAAE;gBAAS,WAAU;0BACtE,YAAY,eAAe;;;;;;;;;;;;AAIpC"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///Users/kartikarora/alt/src/app/auth/complete-profile/page.tsx"],"sourcesContent":["// src/app/auth/complete-profile/page.tsx\n\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { supabaseBrowser } from \"@/lib/supabase/client\";\nimport ProfileImageUploader from \"@/components/ProfileImageUploader\";\n\nexport default function CompleteProfilePage() {\n  const [loading, setLoading] = useState(true);\n  const [user, setUser] = useState<any>(null);\n  const [fullName, setFullName] = useState(\"\");\n  const [username, setUsername] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [phone, setPhone] = useState(\"\");\n  const [profileImage, setProfileImage] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [password, setPassword] = useState(\"\");\n  const router = useRouter();\n\n  useEffect(() => {\n    let mounted = true;\n    supabaseBrowser.auth.getUser().then(({ data }) => {\n      if (!mounted) return;\n      setUser(data.user ?? null);\n      setPhone(data.user?.phone ?? \"\");\n      setLoading(false);\n    });\n    return () => {\n      mounted = false;\n    };\n  }, []);\n\n  if (loading) return <div className=\"p-8 text-white\">Loading‚Ä¶</div>;\n  if (!user) {\n    return (\n      <div className=\"p-8 text-white\">\n        <p>You are not signed in. Please verify email or sign in first.</p>\n        <button onClick={() => router.push(\"/auth\")} className=\"mt-3 px-4 py-2 bg-blue-600 rounded-md\">Go to auth</button>\n      </div>\n    );\n  }\n\n  async function handleComplete(e: React.FormEvent) {\n    e.preventDefault();\n    setLoading(true);\n\n    // Validation: username unique\n    if (username) {\n      const { data: existingUsername } = await supabaseBrowser\n        .from(\"profiles\")\n        .select(\"id\")\n        .eq(\"username\", username)\n        .maybeSingle();\n\n      if (existingUsername) {\n        alert(\"Username already taken.\");\n        setLoading(false);\n        return;\n      }\n    }\n\n    // Validation: email unique\n    if (email) {\n      const { data: existingEmail } = await supabaseBrowser\n        .from(\"profiles\")\n        .select(\"id\")\n        .eq(\"email\", email)\n        .maybeSingle();\n\n      if (existingEmail) {\n        alert(\"Email already registered.\");\n        setLoading(false);\n        return;\n      }\n    }\n\n    // If user signed up by email & wants credentials set, update user with password/email (if password provided).\n    try {\n      if (email || password) {\n        const { error: updateErr } = await supabaseBrowser.auth.updateUser({\n          email: email || undefined,\n          password: password || undefined,\n        });\n\n        if (updateErr) {\n          alert(updateErr.message);\n          setLoading(false);\n          return;\n        }\n      }\n    } catch (err: any) {\n      console.error(err);\n    }\n\n    const profile = {\n      id: user.id,\n      full_name: fullName || null,\n      username: username || null,\n      email: email || null,\n      phone: phone || null,\n      profile_image: profileImage || null,\n      created_at: new Date().toISOString(),\n    };\n\n    const { error } = await supabaseBrowser.from(\"profiles\").upsert(profile, { returning: \"minimal\" });\n\n    if (error) {\n      alert(error.message);\n      setLoading(false);\n      return;\n    }\n\n    router.push(\"/dashboard\");\n    setLoading(false);\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-[radial-gradient(circle_at_top_left,#07102a_0%,#03031a_60%)] p-6 text-white\">\n      <div className=\"max-w-md w-full bg-[#07102a]/80 border border-zinc-800 rounded-xl p-6\">\n        <h2 className=\"text-xl font-semibold mb-4\">Complete your profile</h2>\n\n        <form onSubmit={handleComplete} className=\"space-y-4\">\n          <label className=\"block text-sm text-zinc-300\">\n            Full name\n            <input value={fullName} onChange={(e) => setFullName(e.target.value)} className=\"mt-2 w-full rounded-md bg-zinc-900 p-2\" />\n          </label>\n\n          <label className=\"block text-sm text-zinc-300\">\n            Username\n            <input value={username} onChange={(e) => setUsername(e.target.value)} className=\"mt-2 w-full rounded-md bg-zinc-900 p-2\" required />\n          </label>\n\n          <label className=\"block text-sm text-zinc-300\">\n            Email (optional)\n            <input value={email} onChange={(e) => setEmail(e.target.value)} type=\"email\" className=\"mt-2 w-full rounded-md bg-zinc-900 p-2\" />\n          </label>\n\n          <label className=\"block text-sm text-zinc-300 relative\">\n            Password (optional - set to enable email/password login)\n            <div className=\"mt-2 relative\">\n              <input\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                type={showPassword ? \"text\" : \"password\"}\n                className=\"w-full rounded-md bg-zinc-900 p-2 pr-10\"\n                placeholder=\"Choose a secure password\"\n              />\n              <button type=\"button\" onClick={() => setShowPassword((s) => !s)} className=\"absolute right-2 top-1/2 -translate-y-1/2 text-zinc-400\">\n                {showPassword ? \"üôà\" : \"üëÅÔ∏è\"}\n              </button>\n            </div>\n          </label>\n\n          <label className=\"block text-sm text-zinc-300\">\n            Phone\n            <input value={phone} onChange={(e) => setPhone(e.target.value)} className=\"mt-2 w-full rounded-md bg-zinc-900 p-2\" />\n          </label>\n\n          <div className=\"mt-2\">\n            <ProfileImageUploader userId={user.id} onUpload={(url) => setProfileImage(url)} />\n            {profileImage ? <img src={profileImage} alt=\"avatar\" className=\"mt-3 w-20 h-20 rounded-full object-cover\" /> : null}\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <button className=\"px-4 py-2 bg-blue-600 rounded-md\" type=\"submit\">\n              Save & Continue\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}