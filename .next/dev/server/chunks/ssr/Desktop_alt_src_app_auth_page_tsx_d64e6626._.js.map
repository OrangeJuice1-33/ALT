{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/kartikarora/Desktop/alt/src/app/auth/page.tsx"],"sourcesContent":["// src/app/auth/page.tsx\n\"use client\";\n\nimport { useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { supabaseBrowser } from \"@/lib/supabase/client\";\n\nexport default function AuthPage() {\n  const [tab, setTab] = useState<\"signin\" | \"signup-email\" | \"signup-phone\">(\"signin\");\n  const [identifier, setIdentifier] = useState(\"\"); // email or username for signin\n  const [password, setPassword] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n\n  const [signupEmail, setSignupEmail] = useState(\"\");\n  const [signupPassword, setSignupPassword] = useState(\"\");\n\n  const [phone, setPhone] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n\n  const router = useRouter();\n\n  async function lookupEmailFromUsername(input: string) {\n    if (!input) return null;\n    if (input.includes(\"@\")) return input;\n    const { data: prof } = await supabaseBrowser\n      .from(\"profiles\")\n      .select(\"email\")\n      .eq(\"username\", input)\n      .maybeSingle();\n    return prof?.email ?? null;\n  }\n\n  // SIGN IN (email or username + password)\n  async function handleSignIn(e: React.FormEvent) {\n    e.preventDefault();\n    setLoading(true);\n    try {\n      const email = (await lookupEmailFromUsername(identifier)) ?? identifier;\n      if (!email || !password) {\n        alert(\"Please provide email/username and password.\");\n        return;\n      }\n\n      const { error } = await supabaseBrowser.auth.signInWithPassword({\n        email,\n        password,\n      });\n\n      if (error) {\n        alert(error.message);\n        return;\n      }\n\n      // successful sign in ‚Äî AuthListener will redirect to dashboard\n      router.push(\"/dashboard\");\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  // SIGN UP via EMAIL (verification required)\n  async function handleSignupEmail(e: React.FormEvent) {\n    e.preventDefault();\n    setLoading(true);\n    try {\n      if (!signupEmail || !signupPassword) {\n        alert(\"Provide email and password to sign up.\");\n        return;\n      }\n\n      const { error } = await supabaseBrowser.auth.signUp(\n        {\n          email: signupEmail,\n          password: signupPassword,\n        },\n        {\n          // IMPORTANT: redirect after verification to local complete-profile page\n          // make sure this exact URL is configured in Supabase Redirect URLs\n          emailRedirectTo: \"http://localhost:3000/auth/complete-profile\",\n        }\n      );\n\n      if (error) {\n        alert(error.message);\n        return;\n      }\n\n      alert(\"Verification email sent. Check your inbox (or Supabase Test Emails). After verifying, open the link to continue.\");\n      // keep user on auth page ‚Äî after verifying email, the verification link will open /auth/complete-profile\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  // SIGN UP via PHONE (OTP) ‚Äî phone signs in immediately after verification\n  async function handleSignupPhone(e: React.FormEvent) {\n    e.preventDefault();\n    setLoading(true);\n    try {\n      if (!phone) {\n        alert(\"Enter phone with country code, e.g. +919876543210\");\n        return;\n      }\n\n      const { error } = await supabaseBrowser.auth.signInWithOtp({\n        phone,\n      });\n\n      if (error) {\n        alert(error.message);\n        return;\n      }\n\n      alert(\"OTP sent to phone. After verification on device you will be signed in and should complete your profile.\");\n      router.push(\"/auth/complete-profile\");\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  // Forgot password (email)\n  async function handleForgotPassword() {\n    if (!identifier) {\n      alert(\"Enter your email or username to reset password.\");\n      return;\n    }\n    const email = identifier.includes(\"@\") ? identifier : await lookupEmailFromUsername(identifier);\n    if (!email) {\n      alert(\"No email found for that username.\");\n      return;\n    }\n\n    const { error } = await supabaseBrowser.auth.resetPasswordForEmail(email, {\n      redirectTo: \"http://localhost:3000/auth\",\n    });\n\n    if (error) {\n      alert(error.message);\n    } else {\n      alert(\"Password reset email sent. Check Supabase test emails if SMTP not configured.\");\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-[radial-gradient(circle_at_top_left,#07102a_0%,#03031a_60%)] p-6 text-white\">\n      <div className=\"w-full max-w-lg bg-[#07102a]/80 border border-zinc-800 rounded-xl p-6 shadow-lg\">\n        <div className=\"flex gap-2 mb-6\">\n          <button\n            onClick={() => setTab(\"signin\")}\n            className={`flex-1 py-2 rounded-md ${tab === \"signin\" ? \"bg-blue-600\" : \"bg-zinc-800\"}`}\n          >\n            Sign in\n          </button>\n          <button\n            onClick={() => setTab(\"signup-email\")}\n            className={`flex-1 py-2 rounded-md ${tab === \"signup-email\" ? \"bg-emerald-600\" : \"bg-zinc-800\"}`}\n          >\n            Sign up (Email)\n          </button>\n          <button\n            onClick={() => setTab(\"signup-phone\")}\n            className={`flex-1 py-2 rounded-md ${tab === \"signup-phone\" ? \"bg-amber-600\" : \"bg-zinc-800\"}`}\n          >\n            Sign up (Phone)\n          </button>\n        </div>\n\n        {tab === \"signin\" && (\n          <form onSubmit={handleSignIn} className=\"space-y-4\">\n            <label className=\"block text-sm text-zinc-300\">\n              Email or Username\n              <input\n                value={identifier}\n                onChange={(e) => setIdentifier(e.target.value)}\n                className=\"mt-2 w-full rounded-md bg-zinc-900 border border-zinc-700 p-2\"\n                placeholder=\"you@example.com or username\"\n                autoComplete=\"username\"\n              />\n            </label>\n\n            <label className=\"block text-sm text-zinc-300 relative\">\n              Password\n              <div className=\"mt-2 relative\">\n                <input\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  type={showPassword ? \"text\" : \"password\"}\n                  className=\"w-full rounded-md bg-zinc-900 border border-zinc-700 p-2 pr-10\"\n                  placeholder=\"Your password\"\n                  autoComplete=\"current-password\"\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setShowPassword((s) => !s)}\n                  className=\"absolute right-2 top-1/2 -translate-y-1/2 text-zinc-400\"\n                  aria-label={showPassword ? \"Hide password\" : \"Show password\"}\n                >\n                  {showPassword ? \"üôà\" : \"üëÅÔ∏è\"}\n                </button>\n              </div>\n            </label>\n\n            <div className=\"flex items-center justify-between\">\n              <button type=\"submit\" disabled={loading} className=\"px-4 py-2 bg-blue-600 rounded-md\">\n                {loading ? \"Signing in‚Ä¶\" : \"Sign in\"}\n              </button>\n\n              <button type=\"button\" onClick={handleForgotPassword} className=\"text-sm text-zinc-400 underline\">\n                Forgot password?\n              </button>\n            </div>\n\n            <p className=\"text-sm text-zinc-400\">\n              Not registered?{\" \"}\n              <button onClick={() => setTab(\"signup-email\")} className=\"text-emerald-400 underline\">\n                Create an account\n              </button>\n            </p>\n          </form>\n        )}\n\n        {tab === \"signup-email\" && (\n          <form onSubmit={handleSignupEmail} className=\"space-y-4\">\n            <label className=\"block text-sm text-zinc-300\">\n              Email\n              <input\n                value={signupEmail}\n                onChange={(e) => setSignupEmail(e.target.value)}\n                className=\"mt-2 w-full rounded-md bg-zinc-900 border border-zinc-700 p-2\"\n                placeholder=\"you@example.com\"\n                autoComplete=\"email\"\n                type=\"email\"\n                required\n              />\n            </label>\n\n            <label className=\"block text-sm text-zinc-300 relative\">\n              Password\n              <div className=\"mt-2 relative\">\n                <input\n                  value={signupPassword}\n                  onChange={(e) => setSignupPassword(e.target.value)}\n                  type={showPassword ? \"text\" : \"password\"}\n                  className=\"w-full rounded-md bg-zinc-900 border border-zinc-700 p-2 pr-10\"\n                  placeholder=\"Create a password\"\n                  autoComplete=\"new-password\"\n                  required\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setShowPassword((s) => !s)}\n                  className=\"absolute right-2 top-1/2 -translate-y-1/2 text-zinc-400\"\n                >\n                  {showPassword ? \"üôà\" : \"üëÅÔ∏è\"}\n                </button>\n              </div>\n            </label>\n\n            <div className=\"flex items-center justify-between\">\n              <button type=\"submit\" disabled={loading} className=\"px-4 py-2 bg-emerald-600 rounded-md\">\n                {loading ? \"Sending‚Ä¶\" : \"Create account\"}\n              </button>\n\n              <button type=\"button\" onClick={() => setTab(\"signin\")} className=\"text-sm text-zinc-400 underline\">\n                Sign in instead\n              </button>\n            </div>\n\n            <p className=\"text-sm text-zinc-400\">We will send a verification email. Click it to continue account setup.</p>\n          </form>\n        )}\n\n        {tab === \"signup-phone\" && (\n          <form onSubmit={handleSignupPhone} className=\"space-y-4\">\n            <label className=\"block text-sm text-zinc-300\">\n              Phone (with country code)\n              <input\n                value={phone}\n                onChange={(e) => setPhone(e.target.value)}\n                className=\"mt-2 w-full rounded-md bg-zinc-900 border border-zinc-700 p-2\"\n                placeholder=\"+911234567890\"\n                inputMode=\"tel\"\n                required\n              />\n            </label>\n\n            <div className=\"flex items-center justify-between\">\n              <button type=\"submit\" disabled={loading} className=\"px-4 py-2 bg-amber-600 rounded-md\">\n                {loading ? \"Sending OTP‚Ä¶\" : \"Send OTP\"}\n              </button>\n\n              <button type=\"button\" onClick={() => setTab(\"signin\")} className=\"text-sm text-zinc-400 underline\">\n                Sign in with email\n              </button>\n            </div>\n\n            <p className=\"text-sm text-zinc-400\">After verification you'll complete your profile.</p>\n          </form>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}