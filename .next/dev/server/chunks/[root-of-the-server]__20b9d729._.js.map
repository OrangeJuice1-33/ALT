{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/kartikarora/alt/src/lib/supabase/server.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nexport function supabaseServer() {\n  return createClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEO,SAAS;IACd,OAAO,IAAA,gNAAY,gFAEjB,QAAQ,GAAG,CAAC,yBAAyB;AAEzC"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///Users/kartikarora/alt/src/app/api/reviews/add/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { supabaseServer } from \"@/lib/supabase/server\";\n\nexport async function POST(req: Request) {\n  const supabase = supabaseServer();\n  const body = await req.json();\n  const { venue_id, user_id, rating, review_text } = body;\n\n  if (!venue_id || !user_id || !rating) {\n    return NextResponse.json({ error: \"Missing required fields\" }, { status: 400 });\n  }\n\n  // Insert review\n  const { error } = await supabase.from(\"venue_reviews\").insert({\n    venue_id,\n    user_id,\n    rating,\n    review_text,\n  });\n\n  if (error) {\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n\n  // Recalculate summary fields\n  const { data: stats } = await supabase\n    .from(\"venue_reviews\")\n    .select(\"rating\")\n    .eq(\"venue_id\", venue_id);\n\n  const totalReviews = stats.length;\n  const avgRating =\n    stats.reduce((sum: number, r: any) => sum + r.rating, 0) / totalReviews;\n\n  await supabase\n    .from(\"venue_listings\")\n    .update({\n      review_count: totalReviews,\n      average_rating: avgRating,\n      popularity_score: totalReviews,\n    })\n    .eq(\"id\", venue_id);\n\n  return NextResponse.json({ success: true });\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,WAAW,IAAA,2JAAc;IAC/B,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,MAAM,EAAE,WAAW,EAAE,GAAG;IAEnD,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,QAAQ;QACpC,OAAO,uJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA0B,GAAG;YAAE,QAAQ;QAAI;IAC/E;IAEA,gBAAgB;IAChB,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,iBAAiB,MAAM,CAAC;QAC5D;QACA;QACA;QACA;IACF;IAEA,IAAI,OAAO;QACT,OAAO,uJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;IAEA,6BAA6B;IAC7B,MAAM,EAAE,MAAM,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,iBACL,MAAM,CAAC,UACP,EAAE,CAAC,YAAY;IAElB,MAAM,eAAe,MAAM,MAAM;IACjC,MAAM,YACJ,MAAM,MAAM,CAAC,CAAC,KAAa,IAAW,MAAM,EAAE,MAAM,EAAE,KAAK;IAE7D,MAAM,SACH,IAAI,CAAC,kBACL,MAAM,CAAC;QACN,cAAc;QACd,gBAAgB;QAChB,kBAAkB;IACpB,GACC,EAAE,CAAC,MAAM;IAEZ,OAAO,uJAAY,CAAC,IAAI,CAAC;QAAE,SAAS;IAAK;AAC3C"}}]
}